23.08.04
внешнее проектирование
шаги разработки
первая таблица
----------------------
внешнее проектирование
----------------------
программа будет вести данные БД Восхождения (Climbs)
кроме этого - выводить данные по фиксированным запросам

интерфейс
основное окно программы
	меню
	набор вкладок
	
на каждой вкладке таблица БД
	в виде DataGridView
при открытии новой таблицы добавляется вкладка
при обращении к открытой таблице
	соответствующая вкладка становится активной
открытую вкладку можно закрыть (удалить)

команды редактирования
	добавить 
	удалить
	изменить
добавить, изменить - через диалоговое окно

меню
	таблицы
	редактирование
	запросы
---------------
шаги разработки
---------------
	отображение таблицы стран
	отображение таблицы вершин
	редактирование стран
	редактирование вершин
	отображение и редактирование всех данных
	отображение результатов запросов
	? отображение отчетов по запросам
	
	разработка с git
	каждый шаг - отдельная ветка
	попытаться разделить
		отображение, логику, доступ к данным
		? абстракцию и реализацию
--------------
первая таблица
--------------
соединение с БД - через config
таблица - DataTable (DT)
по команде создается вкладка с DGV
меню: таблицы, редактирование
по командам редактирования изменяем DT и DGV
в диалоге обрабатываем ошибки
везде обрабатываем ошибки
таблица - Страны
пишем как можно проще

шаги
меню
чтение таблицы (строка соединения в коде)

23.08.05
config 
пример использования config
C:\Now\Me\ADO\less02\ls02_DataTable01\ls02_DataTable01.sln  

для .NET стандартом является json config - appsettings.json
для лучшего понимания config попробуем сохранить в нем
	дату последнего сеанса

работа с json config
https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-7.0
для изменения значений нужно перезаписать config
(прочитать, изменить, записать)
https://learn.microsoft.com/en-us/answers/questions/609232/how-to-save-the-updates-i-made-to-appsettings-conf
мораль: лучше это делать через settings.settings

добавление записей
	добавление диалога
	кнопки Ok, Cancel, DialogResult
	проверка данных перед возвратом
	добавление новой записи и обновление grid
	сохранение данных перед выходом

удаление
изменение

все в порядке, кроме удаления
после многих попыток и раздумий до меня дошло
что не удаляются записи по той причине,
что на них могут быть ссылки

системное удаление работает
программное - нет
видимо, в программном чего-то не хватает...

23.08.06
вместо 
dataTable.Rows.RemoveAt(selectedIndex);
нужно
dataTable.Rows[selectedIndex].Delete();

removeAt удаляет запись окончательно,
поэтому при возвращении таблицы
эта запись не участвует в удалении

delete не удаляет, а только метит как удаленную
поэтому при возвращении все нормально
но !
номера записей в dataTable и grid
не синхронизированы

поэтому следует сразу после удаления
синхронизировать их через возвращение (Save)

иногда ошибка - непонятно почему
добавляем try

похоже, нельзя удалять добавленную запись
можно попробовать поставить проверку состояния записи

ошибка происходит при сохранении
после повторном удаления добавленной
после удаления любой

вероятная причина
после первого удаления (сохранения)
происходит рассинхронизация
таблиц на диске и в памяти
удаляемая (добавленнная) запись становится пустой

при удалении до сохранения
добавленная запись просто исчезает

решение всех проблем непростое
нужно работать не с индексом
а получать ссылку на запись таблицы
связанную со строкой грида

23.08.08
вчера была неправильная попытка
продолжения разработки
поэтому возвращаемся назад и думаем по-новому

дальнейшие шаги
добавление-удаление вкладок
загрузка таблиц на вкладки
добавление записей
удаление, изменение

список вкладок (соответствует командам меню)
команда: если есть - активизируем
иначе добавляем
удаление удаляет текущую вкладку

в редактирование добавляем Закрыть
(возможен другой вариант 
check в меню: включить-выключить)
Country меняем на One
добавляем вызов всех таблиц

*** project.txt нужно добавлять записи в начало файла

! настройку грида выполнять по какому-то событию
(? визуализации грида)

создать новую ветку severalTables02 и продолжать на ней
(потом вернуться на master)

загрузка таблицы на вкладку
класс вкладка (с гридом и таблицей)
и с запросом в параметре или в наследовании
создаем не вкладку, а объект по запросу
запрос в наследовании
класс в меню

загрузку побороли

дальше:
зафиксировать ветвь, сделать этот вариант главным (master)
добавить операции редактирования

23.08.18
сделал новую ветвь (не master, пока не знаю, как объединять ветви)
продолжаем: редактирование (insert)

что следовало бы добавить, изменить
	надписи у контролов
	даты показывать без времени
	при добавлении поля следует сделать пустыми
	следить за выделенной строкой в гриде
	общий DataSet 

*AppMenu

23.08.19
насчет общего DataSet - это еще тот вопрос...

после добавления/удаления/изменния записи 
для того, чтобы ей можно было пользоваться
ее надо сохранить
(при уходе со вкладки ее надо сохранять)

дальнейшее рассмотрение этого вопроса
приводит к вопросу о многопользовательской работе
при которой
	необходимо изменения сразу же сохранять
	записи, которые, возможно, будут изменены
	должны быть на сервере блокированы для изменений

в общем, многопользовательская работа с БД 
это отдельный вопрос, который должен быть рассмотрен
со всеми подробностями и тщательно

пока что придерживаемся правильной реализации
однопользовательского режима
(сохранение при уходе с вкладки)

при общем DataSet нужно
	сохранять при уходе с вкладки
	получать Id при сохранении
	(команда CommandUpdate с выходным параметром)

да, у нас помимо редактирования еще и дополнительные запросы...
итак 
= при добавлении поля следует сделать пустыми
= даты показывать без времени
= сохранение при уходе с вкладки (event deselecting)
= следить за выделенной строкой в гриде
* получении Id при Insert
* другая версия меню
* надписи у контролов

23.08.25
нужно еще добавить информационные запросы
и, возможно, отчеты
для реализации Id нужна команда Save

* новое меню
* save, id
* надписи
* запросы
* отчеты